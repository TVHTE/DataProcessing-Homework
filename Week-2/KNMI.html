<!DOCTYPE HTML>

<html>
  <head>

     <!-- http://jquery.com/ -->
     <script src="https://code.jquery.com/jquery-latest.min.js"></script>

  </head>

    <textarea id="knmi_data" style="display:none;">
    20001101,   76
    20001102,   78
    20001103,   77
    20001104,   68
    20001105,   71
    20001106,   94
    20001107,   85
    20001108,   82
    20001109,   78
    20001110,   71
    20001111,   86
    20001112,   87
    20001113,   79
    20001114,   56
    20001115,   57
    20001116,   72
    20001117,   50
    20001118,   64
    20001119,   91
    20001120,   63
    20001121,   62
    20001122,   86
    20001123,   84
    20001124,   70
    20001125,   72
    20001126,   76
    20001127,   66
    20001128,  119
    20001129,  111
    20001130,  106
    20001201,  116
    20001202,  105
    20001203,   84
    20001204,   70
    20001205,   96
    20001206,  109
    20001207,   98
    20001208,  122
    20001209,   94
    20001210,   96
    20001211,  120
    20001212,  131
    20001213,  108
    20001214,   74
    20001215,   56
    20001216,   41
    20001217,   25
    20001218,   32
    20001219,   27
    20001220,   16
    20001221,   -1
    20001222,  -23
    20001223,  -20
    20001224,    6
    20001225,   -6
    20001226,  -22
    20001227,  -10
    20001228,    5
    20001229,    6
    20001230,   17
    20001231,   -1
    20010101,   34
    20010102,   87
    20010103,   67
    20010104,   78
    20010105,   76
    20010106,   59
    20010107,   52
    20010108,   39
    20010109,   40
    20010110,   24
    20010111,   12
    20010112,    7
    20010113,  -11
    20010114,  -19
    20010115,  -21
    20010116,  -31
    20010117,  -48
    20010118,  -37
    20010119,   -5
    20010120,    1
    20010121,   -1
    20010122,   28
    20010123,   70
    20010124,   84
    20010125,   55
    20010126,   45
    20010127,   42
    20010128,   40
    20010129,   23
    20010130,    7
    20010131,   11
    20010201,    6
    20010202,    5
    20010203,    6
    20010204,   27
    20010205,   88
    20010206,  106
    20010207,  101
    20010208,   86
    20010209,   27
    20010210,   25
    20010211,   99
    20010212,  100
    20010213,   58
    20010214,   33
    20010215,   43
    20010216,   24
    20010217,   41
    20010218,   48
    20010219,   51
    20010220,   53
    20010221,   64
    20010222,   55
    20010223,   26
    20010224,  -10
    20010225,   10
    20010226,   19
    20010227,   22
    20010228,   38
    20010301,   19
    20010302,   13
    20010303,  -11
    20010304,   13
    20010305,   18
    20010306,   33
    20010307,   75
    20010308,   88
    20010309,   93
    20010310,   99
    20010311,  111
    20010312,   84
    20010313,   59
    20010314,   54
    20010315,   60
    20010316,   70
    20010317,   34
    20010318,   27
    20010319,   19
    20010320,   19
    20010321,    9
    20010322,   28
    20010323,   67
    20010324,   64
    20010325,   29
    20010326,   30
    20010327,   35
    20010328,   71
    20010329,   66
    20010330,   65
    20010331,   92
    20010401,  113
    20010402,  144
    20010403,  120
    20010404,   92
    20010405,   80
    20010406,  113
    20010407,   89
    20010408,   69
    20010409,   78
    20010410,   96
    20010411,   84
    20010412,   48
    20010413,   38
    20010414,   18
    20010415,   76
    20010416,   66
    20010417,   61
    20010418,   51
    20010419,   39
    20010420,   37
    20010421,   57
    20010422,   59
    20010423,   80
    20010424,  104
    20010425,  102
    20010426,  106
    20010427,  106
    20010428,  106
    20010429,  126
    20010430,  127
    20010501,  107
    20010502,  140
    20010503,  122
    20010504,   84
    20010505,   81
    20010506,  106
    20010507,  111
    20010508,  107
    20010509,  175
    20010510,  194
    20010511,  187
    20010512,  183
    20010513,  187
    20010514,  147
    20010515,  144
    20010516,  137
    20010517,  121
    20010518,  117
    20010519,  118
    20010520,  116
    20010521,  123
    20010522,  139
    20010523,  168
    20010524,  157
    20010525,  154
    20010526,  165
    20010527,  157
    20010528,  175
    20010529,  166
    20010530,  163
    20010531,  133
    20010601,  127
    20010602,  113
    20010603,   97
    20010604,  120
    20010605,  157
    20010606,  159
    20010607,  132
    20010608,  116
    20010609,  106
    20010610,  122
    20010611,  127
    20010612,  141
    20010613,  143
    20010614,  158
    20010615,  171
    20010616,  155
    20010617,  151
    20010618,  132
    20010619,  137
    20010620,  170
    20010621,  149
    20010622,  141
    20010623,  158
    20010624,  183
    20010625,  188
    20010626,  215
    20010627,  198
    20010628,  188
    20010629,  199
    20010630,  194
    20010701,  182
    20010702,  184
    20010703,  207
    20010704,  227
    20010705,  252
    20010706,  247
    20010707,  207
    20010708,  175
    20010709,  174
    20010710,  183
    20010711,  165
    20010712,  153
    20010713,  152
    20010714,  138
    20010715,  141
    20010716,  146
    20010717,  164
    20010718,  157
    20010719,  157
    20010720,  148
    20010721,  155
    20010722,  193
    20010723,  188
    20010724,  193
    20010725,  197
    20010726,  220
    20010727,  216
    20010728,  205
    20010729,  207
    20010730,  217
    20010731,  195
    20010801,  174
    20010802,  201
    20010803,  188
    20010804,  173
    20010805,  158
    20010806,  173
    20010807,  182
    20010808,  161
    20010809,  150
    20010810,  145
    20010811,  163
    20010812,  164
    20010813,  187
    20010814,  216
    20010815,  244
    20010816,  195
    20010817,  179
    20010818,  200
    20010819,  199
    20010820,  177
    20010821,  185
    20010822,  212
    20010823,  226
    20010824,  230
    20010825,  240
    20010826,  225
    20010827,  169
    20010828,  142
    20010829,  150
    20010830,  163
    20010831,  159
    20010901,  146
    20010902,  157
    20010903,  158
    20010904,  138
    20010905,  145
    20010906,  151
    20010907,  150
    20010908,  132
    20010909,  118
    20010910,  130
    20010911,  140
    20010912,  151
    20010913,  128
    20010914,  127
    20010915,  126
    20010916,  103
    20010917,  110
    20010918,  111
    20010919,  112
    20010920,  126
    20010921,  126
    20010922,  126
    20010923,  130
    20010924,  128
    20010925,  111
    20010926,  125
    20010927,  154
    20010928,  160
    20010929,  148
    20010930,  163
    20011001,  169
    20011002,  162
    20011003,  151
    20011004,  138
    20011005,  138
    20011006,  156
    20011007,  153
    20011008,  145
    20011009,  143
    20011010,  140
    20011011,  147
    20011012,  145
    20011013,  166
    20011014,  166
    20011015,  167
    20011016,  130
    20011017,  140
    20011018,  153
    20011019,  157
    20011020,  151
    20011021,  139
    20011022,  120
    20011023,  126
    20011024,  119
    20011025,  131
    20011026,  130
    20011027,  127
    20011028,  112
    20011029,  116
    20011030,  153
    20011031,  118
    20011101,   81
    </textarea>
    <body>
      <canvas id="graph" width="800" height="500">
      </canvas>
    </body>

    <script>

      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        // Typical action to be performed when the document is ready:
        var new_data = xhttp.responseText;
        console.log(data)

        // get data
        var knmi_data = document.getElementById("knmi_data").value;

        // split data
        var splitted_data = new_data.split('\n');
        console.log(splitted_data)

        // lists
        var data = []
        var temp = []
        var days = []
        var month_list = ["Nov", "Dec","Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"]

        // canvas
        var canvas = document.getElementById("graph");
        var ctx = canvas.getContext('2d');
        var width = canvas.width
        var height = canvas.height

        // numbers
        var range_min = 0
        var range_max = width
        var msday = 86400000
        var months = 12
        var xaxes = 100
        var yaxes = 100

        // chunk splitted data
        for (var i = 0; i < splitted_data.length - 1; i++) {
            var chunk = splitted_data[i].split(",");

            // slice first part in yyyy mm dd
            year = chunk[1].replace(/\s/g, '').slice(0, 4) + "-"
            month = chunk[1].replace(/\s/g, '').slice(4, 6) + "-"
            day = chunk[1].replace(/\s/g, '').slice(6, 8)
            tmpdate = new Date(year.concat(month).concat(day))

            // month_list.push(month);
            data.push(tmpdate); // before the ,
            temp.push(parseInt(chunk[2])); // after the ,
        }

        // get days
        for (var i = 0; i < data.length; i++) {
          tmpdays = (data[i].getTime())/msday
          days.push(tmpdays)
        }

        // get min and max from temp
        var domain_min_y = Number.POSITIVE_INFINITY;
        var domain_max_y = Number.NEGATIVE_INFINITY;
        var tmpy;
        for (var i = temp.length-1; i>=0; i--) {
            tmpy = temp[i];
            if (tmpy < domain_min_y) domain_min_y = tmpy;
            if (tmpy > domain_max_y) domain_max_y = tmpy;
        }

        // get min and max from days
        var domain_min_x = Number.POSITIVE_INFINITY;
        var domain_max_x = Number.NEGATIVE_INFINITY;
        var tmpx;
        for (var i = days.length-1; i>=0; i--) {
            tmpx = days[i];
            if (tmpx < domain_min_x) domain_min_x = tmpx;
            if (tmpx > domain_max_x) domain_max_x = tmpx;
        }

        domain_y = [domain_min_y,domain_max_y]
        domain_x = [domain_min_x,domain_max_x]

        range_y = [0,height]
        range_x = [0,width]

        function createTransform(domain, range){
      	// domain is a two-element array of the data bounds [domain_min, domain_max]
      	// range is a two-element array of the screen bounds [range_min, range_max]
      	// this gives you two equations to solve:
      	// range_min = alpha * domain_min + beta
      	// range_max = alpha * domain_max + beta
       		// a solution would be:

          var domain_min = domain[0]
          var domain_max = domain[1]
          var range_min = range[0]
          var range_max = range[1]

          // formulas to calculate the alpha and the beta
         	var alpha = (range_max - range_min) / (domain_max - domain_min)
          var beta = range_max - alpha * domain_max

          // returns the function for the linear transformation (y= a * x + b)
          return function(x){
            return alpha * x + beta;
          }
        }

        // draw the y and x-axes
        ctx.beginPath()
        ctx.moveTo(xaxes,0)
        ctx.lineTo(xaxes,height)
        ctx.moveTo(xaxes,height + domain_min_y)
        ctx.lineTo(width,height + domain_min_y)

        // put values on y axes
        for (var i = 0; i < 10; i++){
          var stap = (domain_min_y - domain_max_y) / 10
          var stapy = height / 10
          ctx.fillText(((domain_min_y + 18) - (i * stap)) , 60, height - i * stapy)
        }

        var j = 0;

        // put values on x axes
        for (var i = 0; i <= width; i++){
          ctx.moveTo(xaxes + i, height + domain_min_y)
          ctx.lineTo(xaxes + i, height + domain_min_y + 15)
          ctx.fillText(month_list[j], xaxes + i, height + domain_min_y + 15)
          i = i + (width/months)
          j++
        }

        ctx.lineTo(width, height + domain_min_y)

        // create transform function
        var transformy = createTransform(domain_y,range_y)
        var transformx = createTransform(domain_x,range_x)

        // create the graph
        for (i = 0; i < temp.length - 1; i++){
          ctx.moveTo(xaxes + transformx(days[i]), height - transformy(temp[i]))
          ctx.lineTo(xaxes +transformx(days[i+1]), height - transformy(temp[i+1]))
        }

        // edit the canvas
        ctx.font = '20px serif';
        ctx.fillText("Max temperature in De Bilt NL", 150 , 50)
        ctx.fillText("TVHTE - 10798595", 150 , 30)
        ctx.font = '10px serif';
        ctx.fillText("http://projects.knmi.nl/klimatologie/daggegevens/selectie.cgi", 150 , 10)

        // actually draw the lines
        ctx.stroke()
    }
    };
    xhttp.open("GET", "KNMI_20011101.txt", true);
    xhttp.send();



    </script>
